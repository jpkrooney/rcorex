
# Test data cross checked with Python solutions were possible

# test dataset
data = structure(c(0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 1, 0,
                1, 0, 1), .Dim = 4:5)
# test slice of dataset (first column)
x_i = c(0, 0, 1, 1)

# data parameters
n_samples <- nrow(data)
n_visible <- ncol(data)
n_hidden = 2
dim_hidden = 3
dim_visible = 2

# tc parameters
tcs = matrix(rep(0.0, n_hidden), nrow=n_hidden)
tc_min = 0.01  # Try to "boost" hidden units with less than tc_min
tc_history <- list()


# initial values for debug (same ones used in Python implementation)
alpha <- array ( c(0.818, 0.792, 0.575, 0.678, 0.914,
                   0.623, 0.884, 0.765, 0.715, 0.888), dim= c(n_hidden, n_visible))
p_rand <- p_rand <- array( dim = c(n_hidden, n_samples, dim_hidden))
p_rand[, , 1] <- c(0.250, 0.156, 0.258, 0.404, 0.229, 0.746, 0.289, 0.430)
p_rand[, , 2] <- c(0.871, 0.284, 0.260, 0.479, 0.467, 0.151, 0.886, 0.336)
p_rand[, , 3] <- c(0.059, 0.299, 0.222, 0.409, 0.110, 0.493, 0.010, 0.197)
p_rand <- log( p_rand)

# Expected p_y_given_x_3d and log_z from normalise_latent - also used as inputs for other function tests
p_y_given_x_3d <- structure(c(0.211864406779661, 0.211096075778079, 0.348648648648649,
                             0.312693498452012, 0.284119106699752, 0.536690647482014,
                             0.243881856540084, 0.446521287642783, 0.738135593220339,
                             0.384303112313938, 0.351351351351351, 0.370743034055728,
                             0.579404466501241, 0.10863309352518, 0.747679324894515,
                             0.348909657320872, 0.05, 0.404600811907984, 0.3,
                             0.31656346749226, 0.136476426799007, 0.354676258992806,
                             0.00843881856540085, 0.204569055036345),
                            .Dim = c(2L, 4L, 3L))

log_z <- structure(c(0.165514438477573, -0.302457358033935, -0.301105092783922,
            0.25619140536041, -0.215671536475509, 0.3293037471426, 0.169742774587095,
            -0.0377018671840115), .Dim = c(2L, 4L))

# calculate_p_y check result
log_p_y <- structure(c(-1.30131233762492, -0.976258809526706, -0.504280872127337,
                       -1.1934620796358, -2.0883943231501, -1.13908336313752),
                     .Dim = 2:3)


#
result_gaussian_no_smooth <- list(
    mean_ml = structure(c(0.485065836713681, 0.652429296866257, 0.549159919734141,
                          0.377327181451717, 0.292808206499491, 0.436770637223431
                          ), .Dim = 2:3),
    sig_ml = structure(c(3.07166862731226, 0.67403283287192, 0.422359821392027,
                         1.34014258508784, 10.2482872274822, 1.12329745214559
                         ), .Dim = 2:3))

result_gaussian_smooth <- list(
    mean_ml = structure(c(0.499004487901739, 0.518163858236057, 0.500459365867796,
                          0.452606870156963, 0.425982897439121, 0.491278733479767),
                        .Dim = 2:3),
    sig_ml = structure(c(1.57183232366738, 0.443890309613783, 0.367339936874075,
                         0.489091878155635, 6.16668958478516, 0.580952434470601),
                       .Dim = 2:3))

result_discrete_no_smooth <- structure(
    c(-0.663769415931969, -0.723414188099684, -1.0562060877474,
      -0.427362203917095, -0.796552426098203, -0.599439615726331,
      -0.474058527830046, -0.974107414300832, -0.347633255622469,
      -1.22539353714455, -0.574243435301211, -0.828121333532572),
    .Dim = c(2L, 2L, 3L))


theta_result_gaussian_no_smooth <- list(
    list(mean_ml = structure(c(0.485065836713681, 0.652429296866257, 0.549159919734141,
                               0.377327181451717, 0.292808206499491, 0.436770637223431
                               ), .Dim = 2:3),
         sig_ml = structure(c(3.07166862731226, 0.67403283287192, 0.422359821392027,
                              1.34014258508784, 10.2482872274822, 1.12329745214559
                              ), .Dim = 2:3)),
    list(mean_ml = structure(c(0.485065836713681, 0.652429296866257, 0.549159919734141,
                               0.377327181451717, 0.292808206499491, 0.436770637223431),
                             .Dim = 2:3),
         sig_ml = structure(c(3.07166862731226, 0.67403283287192, 0.422359821392027,
                              1.34014258508784, 10.2482872274822,1.12329745214559),
                            .Dim = 2:3)),
    list(mean_ml = structure(c(0.485065836713681, 0.652429296866257, 0.549159919734141,
                               0.377327181451717, 0.292808206499491, 0.436770637223431),
                             .Dim = 2:3),
         sig_ml = structure(c(3.07166862731226, 0.67403283287192, 0.422359821392027,
                              1.34014258508784, 10.2482872274822, 1.12329745214559),
                            .Dim = 2:3)),
    list(mean_ml = structure(c(0.544348069962135, 0.503791656067947, 0.45478936738257,
                               0.593484480213392, 0.623215432246983, 0.407004543860708),
                             .Dim = 2:3),
         sig_ml = structure(c(3.0502249514598, 0.743052446088727, 0.422995615430913,
                              1.37613013535667, 11.6214986931416, 1.10206364242556),
                            .Dim = 2:3)),
    list(mean_ml = structure(c(0.544348069962135, 0.503791656067947, 0.45478936738257,
                               0.593484480213392, 0.623215432246983, 0.407004543860708),
                             .Dim = 2:3),
         sig_ml = structure(c(3.0502249514598, 0.743052446088727, 0.422995615430913,
                              1.37613013535667, 11.6214986931416, 1.10206364242556),
                            .Dim = 2:3)))






theta_i_gaussian_ns <- theta_result_gaussian_no_smooth[[1]]

marginal_p_gaussian_result <- structure(c(-1.51834884879508, -1.03745939496067, -1.51834884879508,
            -1.03745939496067, -1.5232107545207, -0.811314184471757,
            -1.5232107545207, -0.811314184471757, -0.845003554373404,
            -1.11844618765833, -0.845003554373404, -1.11844618765833,
            -0.728610097315585, -1.20998332699955, -0.728610097315585,
            -1.20998332699955, -2.08667680351517, -1.06198733736554,
            -2.08667680351517, -1.06198733736554, -2.10689401531861,
            -1.1182764019012, -2.10689401531861, -1.1182764019012),
          .Dim = c(2L, 4L, 3L))

theta_result_discrete_no_smooth <- list(
    structure(c(-0.663769415931969, -0.723414188099684, -1.0562060877474, -0.427362203917095,
                -0.796552426098203, -0.599439615726331, -0.474058527830046, -0.974107414300832,
                -0.347633255622469, -1.22539353714455, -0.574243435301211, -0.828121333532572),
              .Dim = c(2L, 2L, 3L)),
    structure(c(-0.663769415931969, -0.723414188099684, -1.0562060877474, -0.427362203917095,
                -0.796552426098203, -0.599439615726331, -0.474058527830046, -0.974107414300832,
                -0.347633255622469, -1.22539353714455, -0.574243435301211, -0.828121333532572),
              .Dim = c(2L, 2L, 3L)),
    structure(c(-0.663769415931969, -0.723414188099684, -1.0562060877474, -0.427362203917095,
                -0.796552426098203, -0.599439615726331, -0.474058527830046, -0.974107414300832,
                -0.347633255622469, -1.22539353714455, -0.574243435301211, -0.828121333532572),
              .Dim = c(2L, 2L, 3L)),
    structure(c(-0.785847587352773, -0.608315829295159, -0.700749264685316, -0.685602452367139,
                -0.606651651571159, -0.78783869380893, -0.899754571446817, -0.522003625144585,
                -0.974766365320388, -0.473659084807036, -0.522813148290794, -0.898574651869688),
              .Dim = c(2L, 2L, 3L)),
    structure(c(-0.785847587352773, -0.608315829295159, -0.700749264685316, -0.685602452367139,
                -0.606651651571159, -0.78783869380893, -0.899754571446817, -0.522003625144585,
                -0.974766365320388, -0.473659084807036, -0.522813148290794, -0.898574651869688),
              .Dim = c(2L, 2L, 3L)))
theta_i_discrete_ns <- theta_result_discrete_no_smooth[[1]]


marginal_p_discrete_result <- structure(c(-0.663769415931969, -1.0562060877474, -0.663769415931969,
                                          -1.0562060877474, -0.723414188099684, -0.427362203917095,
                                          -0.723414188099684, -0.427362203917095, -0.796552426098203,
                                          -0.474058527830046, -0.796552426098203, -0.474058527830046,
                                          -0.599439615726331, -0.974107414300832, -0.599439615726331,
                                          -0.974107414300832, -0.347633255622469, -0.574243435301211,
                                          -0.347633255622469, -0.574243435301211, -1.22539353714455,
                                          -0.828121333532572, -1.22539353714455, -0.828121333532572),
                                        .Dim = c(2L, 4L, 3L))

log_marg_x_4d_gaussian <- structure(c(-0.4230094145954, 0.031842658883994, -0.4230094145954,
            0.031842658883994, -0.51768472456228, 0.203697584960249, -0.51768472456228,
            0.203697584960249, -0.4230094145954, 0.031842658883994, -0.4230094145954,
            0.031842658883994, -0.51768472456228, 0.203697584960249, -0.51768472456228,
            0.203697584960249, -0.4230094145954, 0.031842658883994, -0.4230094145954,
            0.031842658883994, -0.51768472456228, 0.203697584960249, -0.51768472456228,
            0.203697584960249, -0.513382955316622, 0.107067780042605, -0.417548851555979,
            0.117899823975262, -0.513382955316622, 0.107067780042605, -0.417548851555979,
            0.117899823975262, -0.513382955316622, 0.107067780042605, -0.417548851555979,
            0.117899823975262, -0.513382955316622, 0.107067780042605, -0.417548851555979,
            0.117899823975262, 0.250335879826277, -0.0491441338136682, 0.250335879826277,
            -0.0491441338136682, 0.276915932642831, -0.194971557567539, 0.276915932642831,
            -0.194971557567539, 0.250335879826277, -0.0491441338136682, 0.250335879826277,
            -0.0491441338136682, 0.276915932642831, -0.194971557567539, 0.276915932642831,
            -0.194971557567539, 0.250335879826277, -0.0491441338136682, 0.250335879826277,
            -0.0491441338136682, 0.276915932642831, -0.194971557567539, 0.276915932642831,
            -0.194971557567539, 0.278507644841803, -0.158254323764854, 0.252920434083637,
            -0.084592212939548, 0.278507644841803, -0.158254323764854, 0.252920434083637,
            -0.084592212939548, 0.278507644841803, -0.158254323764854, 0.252920434083637,
            -0.084592212939548, 0.278507644841803, -0.158254323764854, 0.252920434083637,
            -0.084592212939548, -0.991337369315488, 0.00731471647912363,
            -0.991337369315488, 0.00731471647912363, -1.10136798536019, -0.103264632469194,
            -1.10136798536019, -0.103264632469194, -0.991337369315488, 0.00731471647912363,
            -0.991337369315488, 0.00731471647912363, -1.10136798536019, -0.103264632469194,
            -1.10136798536019, -0.103264632469194, -0.991337369315488, 0.00731471647912363,
            -0.991337369315488, 0.00731471647912363, -1.10136798536019, -0.103264632469194,
            -1.10136798536019, -0.103264632469194, -1.15034132621139, 0.0056116209557846,
            -1.05844413064882, -0.073042163906671, -1.15034132621139, 0.0056116209557846,
            -1.05844413064882, -0.073042163906671, -1.15034132621139, 0.0056116209557846,
            -1.05844413064882, -0.073042163906671, -1.15034132621139, 0.0056116209557846,
            -1.05844413064882, -0.073042163906671), .Dim = c(2L, 4L, 5L,
                                                             3L))







log_marg_x_4d_discrete <- structure(c(
  0.0294637765146899, -0.363042232403415, 0.0294637765146899, -0.363042232403415, -0.0303530120290427,
  0.265768302136856, -0.0303530120290427, 0.265768302136856, 0.0294637765146899, -0.363042232403415,
  0.0294637765146899, -0.363042232403415, -0.0303530120290427, 0.265768302136856, -0.0303530120290427,
  0.265768302136856, 0.0294637765146899, -0.363042232403415, 0.0294637765146899, -0.363042232403415,
  -0.0303530120290427, 0.265768302136856, -0.0303530120290427, 0.265768302136856, -0.0927612657953703,
  -0.00760421589983051, 0.0848922139713737, 0.00754685997181348, -0.0927612657953703, -0.00760421589983051,
  0.0848922139713737, 0.00754685997181348, -0.0927612657953703, -0.00760421589983051, 0.0848922139713737,
  0.00754685997181348, -0.0927612657953703, -0.00760421589983051, 0.0848922139713737, 0.00754685997181348,
  -0.103319233651544, 0.219105327513939, -0.103319233651544, 0.219105327513939, 0.0936215603443104,
  -0.28097690824688, 0.0936215603443104, -0.28097690824688, -0.103319233651544, 0.219105327513939,
  -0.103319233651544, 0.219105327513939, 0.0936215603443104,-0.28097690824688, 0.0936215603443104,
  -0.28097690824688, -0.103319233651544, 0.219105327513939, -0.103319233651544, 0.219105327513939,
  0.0936215603443104, -0.28097690824688, 0.0936215603443104, -0.28097690824688, 0.0864346699862441,
  -0.206609522661332, -0.0946306505423971, 0.171145687194367, 0.0864346699862441, -0.206609522661332,
  -0.0946306505423971, 0.171145687194367, 0.0864346699862441, -0.206609522661332, -0.0946306505423971,
  0.171145687194367, 0.0864346699862441, -0.206609522661332, -0.0946306505423971, 0.171145687194367,
  0.34559993682419, 0.118920420042774, 0.34559993682419, 0.118920420042774, -0.532332361073909,
  -0.134990827478621, -0.532332361073909, -0.134990827478621, 0.34559993682419, 0.118920420042774,
  0.34559993682419, 0.118920420042774, -0.532332361073909, -0.134990827478621, -0.532332361073909,
  -0.134990827478621, 0.34559993682419, 0.118920420042774, 0.34559993682419, 0.118920420042774,
  -0.532332361073909, -0.134990827478621, -0.532332361073909, -0.134990827478621, -0.281680043762985,
  0.170331900494691, 0.219548958459497, -0.205425339530735, -0.281680043762985, 0.170331900494691,
  0.219548958459497, -0.205425339530735, -0.281680043762985, 0.170331900494691, 0.219548958459497,
  -0.205425339530735, -0.281680043762985, 0.170331900494691, 0.219548958459497, -0.205425339530735),
  .Dim = c(2L, 4L, 5L, 3L))


alpha_4latent_test <- structure(c(1.00020021445258, 0.000701057459227741, 1.00068521859567,
                             0.000527959984261543, 1.00091687577451, 0.000807935200864449,
                             1.00028439945728, 0.0009565001251176, 1.00010465012793, 0.000110453018685803),
                           .Dim = c(2L, 5L))


update_alpha_test_result_seed5 <- structure(c(1.00010465012793, 0.000110453018685803, 1.00070105745923,
                                              0.000273284949595109, 1.00052795998426, 0.000490513201802969,
                                              1.00080793520086, 0.000318404018646106, 1.00095650012512,
                                              0.000559172826586291),
                                            .Dim = c(2L, 5L))

updated_p_y_given_x_3d <- structure(c(0.0120966860928375, 0.37678808994633, 0.0153701508717977,
                                      0.376791949782257, 0.00843794530480509, 0.376931392538745,
                                      0.0107323476636507, 0.376935253639364, 0.987623693745951,
                                      0.303090551639091, 0.984277348430314, 0.303113975604685,
                                      0.991375794272762, 0.303009682882093, 0.989032603345896,
                                      0.303033100434402, 0.000279620161211356, 0.320121358414579,
                                      0.000352500697888493, 0.320094074613059, 0.000186260422432821,
                                      0.320058924579162, 0.000235048990453142, 0.320031645926234),
                                    .Dim = c(2L, 4L, 3L))

updated_log_z <- structure(c(0.816755123445272, -7.36603179469996e-06, 0.768964780157148,
                             -6.05274571589323e-06, 0.89275126619304, -3.75601370286249e-05,
                             0.843933262518173, -3.62463115813506e-05),
                           .Dim = c(2L, 4L))

updated_tc <- list(tcs = structure(c(0.830601108078408, -2.18063065301422e-05),
                                   .Dim = 2:1),
                   tc_history = list(
                       structure(c(0.830601108078408, -2.18063065301422e-05),
                                 .Dim = 2:1)))



### arguments for estimate parameters functions
data_est_tests = matrix(c(0,0,0,0,0,
                0,0,0,1,3,
                1,1,1,0,0,
                1,1,2,1,1), ncol=5, byrow = TRUE)

p_y_given_x_3d_estimate_discrete <- structure(c(0.352571404064629, 0.516565616454422, 0.271996744666052,
                                                0.259660130196914, 0.38299426688219, 0.516368047392833,
                                                0.457227950088999, 0.525449045419763, 0.266052920442782,
                                                0.224950707204062, 0.399166059983369, 0.489836543528228,
                                                0.295052625911883, 0.226610440633316, 0.30934529251417,
                                                0.241025360750108, 0.381375675492589, 0.258483676341517,
                                                0.328837195350579, 0.250503326274858, 0.321953107205926,
                                                0.25702151197385, 0.233426757396831, 0.233525593830129),
                                              .Dim = c(2L, 4L, 3L))

est_pars_discrete_nosmooth_result <- structure( c(-0.690196062363251, -1.16482769262915, -7.29219446054588,
                                                 -1.68273458973219, -0.566587691749003, -1.24155904281171,
                                                 -7.50771358987276, -1.94449621428089, -0.817926446411135,
                                                 -1.41193055914126, -7.14961608357323, -1.15773647265773,
                                                 -0.963775333588961, -1.58965570378756, -7.07869822094153,
                                                 -0.88258705381008, -0.589206179256023, -1.68930824336754,
                                                 -7.14645144727233, -1.34785226197017, -0.664197823465698,
                                                 -1.45371843305251, -6.91128315711602, -1.38382694191872),
                                                .Dim = c(4L, 2L, 3L))

est_pars_discrete_withsmooth_result <- structure(c(-0.691428442324175, -1.25150837227929, -7.83340460080994,
            -1.54801054848486, -0.616060958273512, -1.29782620898409, -8.02865783834929,
            -1.67942298347093, -0.762123655742672, -1.40077943290783, -7.71494591260892,
            -1.25010491763946, -0.84152734628134, -1.49948951722073, -7.620674905645,
            -1.06359064695744, -0.635395587717837, -1.53931139209157, -7.75752981404189,
            -1.36524616439491, -0.676415722007678, -1.42446686681132, -7.46567266459528,
            -1.38487627511918), .Dim = c(4L, 2L, 3L))


tc_hist_converged <- list(structure(c(0.0919859795589572, 0.00544256960649925), .Dim = 2:1),
     structure(c(0.536840469673255, 0.0212412648471452), .Dim = 2:1),
     structure(c(1.19480727651736, 0.0781317872088292), .Dim = 2:1),
     structure(c(1.36132996135349, 0.237936327502543), .Dim = 2:1),
     structure(c(1.38376905327964, 0.483661910947172), .Dim = 2:1),
     structure(c(1.38405118147144, 0.633487779837526), .Dim = 2:1),
     structure(c(1.38405123782951, 0.680365673117113), .Dim = 2:1),
     structure(c(1.38405127508472, 0.691033475969152), .Dim = 2:1),
     structure(c(1.38405131288432, 0.691644466118563), .Dim = 2:1),
     structure(c(1.38405135124099, 0.691648885312992), .Dim = 2:1),
     structure(c(1.38405139016679, 0.691648906408284), .Dim = 2:1),
     structure(c(1.38405142967412, 0.691648907783547), .Dim = 2:1),
     structure(c(1.38405146977576, 0.691648909075495), .Dim = 2:1),
     structure(c(1.38405151048485, 0.69164891037193), .Dim = 2:1),
     structure(c(1.38405155181492, 0.691648911673268), .Dim = 2:1),
     structure(c(1.38405159377991, 0.691648912979536), .Dim = 2:1),
     structure(c(1.38405163639416, 0.691648914290762), .Dim = 2:1),
     structure(c(1.38405167967248, 0.691648915606969), .Dim = 2:1),
     structure(c(1.38405172363009, 0.691648916928184), .Dim = 2:1))

