# load withr as needed by some tests that use random numbers
library(withr)

# Test data cross checked with Python solutions were possible

# test dataset
data = structure(c(0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 1, 0,
                1, 0, 1), .Dim = 4:5)
# test slice of dataset (first column)
x_i = c(0, 0, 1, 1)

# data parameters
n_samples <- nrow(data)
n_visible <- ncol(data)
n_hidden = 2
dim_hidden = 3
dim_visible = 2

# tc parameters
tcs = matrix(rep(0.0, n_hidden), nrow=n_hidden)
tc_min = 0.01  # Try to "boost" hidden units with less than tc_min
tc_history <- list()


#### initial values for debug  ####
alpha <- array ( c(0.818, 0.792, 0.575, 0.678, 0.914,
                   0.623, 0.884, 0.765, 0.715, 0.888), dim= c(n_hidden, n_visible))
p_rand <- p_rand <- array( dim = c(n_hidden, n_samples, dim_hidden))
p_rand[, , 1] <- c(0.250, 0.156, 0.258, 0.404, 0.229, 0.746, 0.289, 0.430)
p_rand[, , 2] <- c(0.871, 0.284, 0.260, 0.479, 0.467, 0.151, 0.886, 0.336)
p_rand[, , 3] <- c(0.059, 0.299, 0.222, 0.409, 0.110, 0.493, 0.010, 0.197)
p_rand <- log( p_rand)

# Expected p_y_given_x_3d and log_z from normalise_latent - also used as inputs for other function tests
p_y_given_x_3d <- structure(c(0.211864406779661, 0.211096075778079, 0.348648648648649,
                             0.312693498452012, 0.284119106699752, 0.536690647482014,
                             0.243881856540084, 0.446521287642783, 0.738135593220339,
                             0.384303112313938, 0.351351351351351, 0.370743034055728,
                             0.579404466501241, 0.10863309352518, 0.747679324894515,
                             0.348909657320872, 0.05, 0.404600811907984, 0.3,
                             0.31656346749226, 0.136476426799007, 0.354676258992806,
                             0.00843881856540085, 0.204569055036345),
                            .Dim = c(2L, 4L, 3L))

log_z <- structure(c(0.165514438477573, -0.302457358033935, -0.301105092783922,
            0.25619140536041, -0.215671536475509, 0.3293037471426, 0.169742774587095,
            -0.0377018671840115), .Dim = c(2L, 4L))

# calculate_p_y check result
log_p_y <- structure(c(-1.30131233762492, -0.976258809526706, -0.504280872127337,
                       -1.1934620796358, -2.0883943231501, -1.13908336313752),
                     .Dim = 2:3)


#
result_gaussian_no_smooth <- list(
    mean_ml = structure(c(0.485065836713681, 0.652429296866257, 0.549159919734141,
                          0.377327181451717, 0.292808206499491, 0.436770637223431
                          ), .Dim = 2:3),
    sig_ml = structure(c(3.07166862731226, 0.67403283287192, 0.422359821392027,
                         1.34014258508784, 10.2482872274822, 1.12329745214559
                         ), .Dim = 2:3))

result_gaussian_smooth <- list(
    mean_ml = structure(c(0.499004487901739, 0.518163858236057, 0.500459365867796,
                          0.452606870156963, 0.425982897439121, 0.491278733479767),
                        .Dim = 2:3),
    sig_ml = structure(c(1.57183232366738, 0.443890309613783, 0.367339936874075,
                         0.489091878155635, 6.16668958478516, 0.580952434470601),
                       .Dim = 2:3))

result_discrete_no_smooth <- structure(
    c(-0.663769415931969, -0.723414188099684, -1.0562060877474,
      -0.427362203917095, -0.796552426098203, -0.599439615726331,
      -0.474058527830046, -0.974107414300832, -0.347633255622469,
      -1.22539353714455, -0.574243435301211, -0.828121333532572),
    .Dim = c(2L, 2L, 3L))


theta_result_gaussian_no_smooth <- list(
    list(mean_ml = structure(c(0.485065836713681, 0.652429296866257, 0.549159919734141,
                               0.377327181451717, 0.292808206499491, 0.436770637223431
                               ), .Dim = 2:3),
         sig_ml = structure(c(3.07166862731226, 0.67403283287192, 0.422359821392027,
                              1.34014258508784, 10.2482872274822, 1.12329745214559
                              ), .Dim = 2:3)),
    list(mean_ml = structure(c(0.485065836713681, 0.652429296866257, 0.549159919734141,
                               0.377327181451717, 0.292808206499491, 0.436770637223431),
                             .Dim = 2:3),
         sig_ml = structure(c(3.07166862731226, 0.67403283287192, 0.422359821392027,
                              1.34014258508784, 10.2482872274822,1.12329745214559),
                            .Dim = 2:3)),
    list(mean_ml = structure(c(0.485065836713681, 0.652429296866257, 0.549159919734141,
                               0.377327181451717, 0.292808206499491, 0.436770637223431),
                             .Dim = 2:3),
         sig_ml = structure(c(3.07166862731226, 0.67403283287192, 0.422359821392027,
                              1.34014258508784, 10.2482872274822, 1.12329745214559),
                            .Dim = 2:3)),
    list(mean_ml = structure(c(0.544348069962135, 0.503791656067947, 0.45478936738257,
                               0.593484480213392, 0.623215432246983, 0.407004543860708),
                             .Dim = 2:3),
         sig_ml = structure(c(3.0502249514598, 0.743052446088727, 0.422995615430913,
                              1.37613013535667, 11.6214986931416, 1.10206364242556),
                            .Dim = 2:3)),
    list(mean_ml = structure(c(0.544348069962135, 0.503791656067947, 0.45478936738257,
                               0.593484480213392, 0.623215432246983, 0.407004543860708),
                             .Dim = 2:3),
         sig_ml = structure(c(3.0502249514598, 0.743052446088727, 0.422995615430913,
                              1.37613013535667, 11.6214986931416, 1.10206364242556),
                            .Dim = 2:3)))


theta_i_bernoulli_ns <- structure(c(-1.43626304296777, -1.38760598609224, -1.39408499537967,
            -1.3888896801509, -1.43103321699891, -0.0682080796686932, -0.106941919424571,
            -0.515999177936465, -0.990771251614206, -0.114663818967529, -0.198430972290225,
            -1.09836725634523, -0.0966215282678604, -0.879617779632099, -0.111255345284007,
            -1.04131843254436, -0.610398534801789, -0.903270327486098, -0.0331088161328807,
            -0.961009346530773, -0.348499528714456, -0.216739329043776, -0.250896956305951,
            -1.08136242907494, -0.866431879810989, -0.250656692893244, -0.295983767369762,
            -0.154706651112065, -0.743658949504606, -0.948618240072392, -0.121713565313257,
            -0.514743427745998, -1.04543410101905, -0.0737492325715721, -0.804434834048152,
            -0.964943704311736, -0.804558236966841, -0.699230616912246, -0.114115756703541,
            -0.495703916531056), .Dim = c(2L, 2L, 10L))

marginal_p_bernoulli_result <- structure(
  c(-1.43626304296777, -1.39408499537967, -1.43103321699891, -0.106941919424571,
    -0.990771251614206, -0.198430972290225, -0.0966215282678604, -0.111255345284007,
    -0.610398534801789, -0.0331088161328807, -0.348499528714456, -0.250896956305951,
    -0.866431879810989, -0.295983767369762, -0.743658949504606, -0.121713565313257,
    -1.04543410101905, -0.804434834048152, -0.804558236966841, -0.114115756703541,
    -1.43626304296777, -1.39408499537967, -1.43103321699891, -0.106941919424571,
    -0.990771251614206, -0.198430972290225, -0.0966215282678604, -0.111255345284007,
    -0.610398534801789, -0.0331088161328807, -0.348499528714456, -0.250896956305951,
    -0.866431879810989, -0.295983767369762, -0.743658949504606, -0.121713565313257,
    -1.04543410101905, -0.804434834048152, -0.804558236966841, -0.114115756703541,
    -1.38760598609224, -1.3888896801509, -0.0682080796686932, -0.515999177936465,
    -0.114663818967529, -1.09836725634523, -0.879617779632099, -1.04131843254436,
    -0.903270327486098, -0.961009346530773, -0.216739329043776, -1.08136242907494,
    -0.250656692893244, -0.154706651112065, -0.948618240072392, -0.514743427745998,
    -0.0737492325715721, -0.964943704311736, -0.699230616912246, -0.495703916531056,
    -1.38760598609224, -1.3888896801509, -0.0682080796686932, -0.515999177936465,
    -0.114663818967529, -1.09836725634523, -0.879617779632099, -1.04131843254436,
    -0.903270327486098, -0.961009346530773, -0.216739329043776, -1.08136242907494,
    -0.250656692893244, -0.154706651112065, -0.948618240072392, -0.514743427745998,
    -0.0737492325715721, -0.964943704311736, -0.699230616912246, -0.495703916531056),
  .Dim = c(2L, 10L, 4L))


theta_i_gaussian_ns <- theta_result_gaussian_no_smooth[[1]]

marginal_p_gaussian_result <- structure(c(-1.51834884879508, -1.03745939496067, -0.845003554373404,
                                          -1.11844618765833, -2.08667680351517, -1.06198733736554,
                                          -1.51834884879508, -1.03745939496067, -0.845003554373404,
                                          -1.11844618765833, -2.08667680351517, -1.06198733736554,
                                          -1.5232107545207, -0.811314184471757, -0.728610097315585,
                                          -1.20998332699955, -2.10689401531861, -1.1182764019012,
                                          -1.5232107545207, -0.811314184471757, -0.728610097315585,
                                          -1.20998332699955, -2.10689401531861, -1.1182764019012),
                                        .Dim = 2:4)

theta_result_discrete_no_smooth <- list(
    structure(c(-0.663769415931969, -0.723414188099684, -1.0562060877474, -0.427362203917095,
                -0.796552426098203, -0.599439615726331, -0.474058527830046, -0.974107414300832,
                -0.347633255622469, -1.22539353714455, -0.574243435301211, -0.828121333532572),
              .Dim = c(2L, 2L, 3L)),
    structure(c(-0.663769415931969, -0.723414188099684, -1.0562060877474, -0.427362203917095,
                -0.796552426098203, -0.599439615726331, -0.474058527830046, -0.974107414300832,
                -0.347633255622469, -1.22539353714455, -0.574243435301211, -0.828121333532572),
              .Dim = c(2L, 2L, 3L)),
    structure(c(-0.663769415931969, -0.723414188099684, -1.0562060877474, -0.427362203917095,
                -0.796552426098203, -0.599439615726331, -0.474058527830046, -0.974107414300832,
                -0.347633255622469, -1.22539353714455, -0.574243435301211, -0.828121333532572),
              .Dim = c(2L, 2L, 3L)),
    structure(c(-0.785847587352773, -0.608315829295159, -0.700749264685316, -0.685602452367139,
                -0.606651651571159, -0.78783869380893, -0.899754571446817, -0.522003625144585,
                -0.974766365320388, -0.473659084807036, -0.522813148290794, -0.898574651869688),
              .Dim = c(2L, 2L, 3L)),
    structure(c(-0.785847587352773, -0.608315829295159, -0.700749264685316, -0.685602452367139,
                -0.606651651571159, -0.78783869380893, -0.899754571446817, -0.522003625144585,
                -0.974766365320388, -0.473659084807036, -0.522813148290794, -0.898574651869688),
              .Dim = c(2L, 2L, 3L)))
theta_i_discrete_ns <- theta_result_discrete_no_smooth[[1]]


marginal_p_discrete_result <- structure(c(-0.663769415931969, -1.0562060877474, -0.796552426098203,
                                          -0.474058527830046, -0.347633255622469, -0.574243435301211,
                                          -0.663769415931969, -1.0562060877474, -0.796552426098203,
                                          -0.474058527830046, -0.347633255622469, -0.574243435301211,
                                          -0.723414188099684, -0.427362203917095, -0.599439615726331,
                                          -0.974107414300832, -1.22539353714455, -0.828121333532572,
                                          -0.723414188099684, -0.427362203917095, -0.599439615726331,
                                          -0.974107414300832, -1.22539353714455, -0.828121333532572),
                                        .Dim = 2:4)

log_marg_x_4d_gaussian <- structure(c(-0.4230094145954, 0.031842658883994, -0.4230094145954,
            0.031842658883994, -0.51768472456228, 0.203697584960249, -0.51768472456228,
            0.203697584960249, -0.4230094145954, 0.031842658883994, -0.4230094145954,
            0.031842658883994, -0.51768472456228, 0.203697584960249, -0.51768472456228,
            0.203697584960249, -0.4230094145954, 0.031842658883994, -0.4230094145954,
            0.031842658883994, -0.51768472456228, 0.203697584960249, -0.51768472456228,
            0.203697584960249, -0.513382955316622, 0.107067780042605, -0.417548851555979,
            0.117899823975262, -0.513382955316622, 0.107067780042605, -0.417548851555979,
            0.117899823975262, -0.513382955316622, 0.107067780042605, -0.417548851555979,
            0.117899823975262, -0.513382955316622, 0.107067780042605, -0.417548851555979,
            0.117899823975262, 0.250335879826277, -0.0491441338136682, 0.250335879826277,
            -0.0491441338136682, 0.276915932642831, -0.194971557567539, 0.276915932642831,
            -0.194971557567539, 0.250335879826277, -0.0491441338136682, 0.250335879826277,
            -0.0491441338136682, 0.276915932642831, -0.194971557567539, 0.276915932642831,
            -0.194971557567539, 0.250335879826277, -0.0491441338136682, 0.250335879826277,
            -0.0491441338136682, 0.276915932642831, -0.194971557567539, 0.276915932642831,
            -0.194971557567539, 0.278507644841803, -0.158254323764854, 0.252920434083637,
            -0.084592212939548, 0.278507644841803, -0.158254323764854, 0.252920434083637,
            -0.084592212939548, 0.278507644841803, -0.158254323764854, 0.252920434083637,
            -0.084592212939548, 0.278507644841803, -0.158254323764854, 0.252920434083637,
            -0.084592212939548, -0.991337369315488, 0.00731471647912363,
            -0.991337369315488, 0.00731471647912363, -1.10136798536019, -0.103264632469194,
            -1.10136798536019, -0.103264632469194, -0.991337369315488, 0.00731471647912363,
            -0.991337369315488, 0.00731471647912363, -1.10136798536019, -0.103264632469194,
            -1.10136798536019, -0.103264632469194, -0.991337369315488, 0.00731471647912363,
            -0.991337369315488, 0.00731471647912363, -1.10136798536019, -0.103264632469194,
            -1.10136798536019, -0.103264632469194, -1.15034132621139, 0.0056116209557846,
            -1.05844413064882, -0.073042163906671, -1.15034132621139, 0.0056116209557846,
            -1.05844413064882, -0.073042163906671, -1.15034132621139, 0.0056116209557846,
            -1.05844413064882, -0.073042163906671, -1.15034132621139, 0.0056116209557846,
            -1.05844413064882, -0.073042163906671), .Dim = c(2L, 4L, 5L,
                                                             3L))







log_marg_x_4d_discrete <- structure(c(
  0.0294637765146899, -0.363042232403415, 0.0294637765146899, -0.363042232403415, -0.0303530120290427,
  0.265768302136856, -0.0303530120290427, 0.265768302136856, 0.0294637765146899, -0.363042232403415,
  0.0294637765146899, -0.363042232403415, -0.0303530120290427, 0.265768302136856, -0.0303530120290427,
  0.265768302136856, 0.0294637765146899, -0.363042232403415, 0.0294637765146899, -0.363042232403415,
  -0.0303530120290427, 0.265768302136856, -0.0303530120290427, 0.265768302136856, -0.0927612657953703,
  -0.00760421589983051, 0.0848922139713737, 0.00754685997181348, -0.0927612657953703, -0.00760421589983051,
  0.0848922139713737, 0.00754685997181348, -0.0927612657953703, -0.00760421589983051, 0.0848922139713737,
  0.00754685997181348, -0.0927612657953703, -0.00760421589983051, 0.0848922139713737, 0.00754685997181348,
  -0.103319233651544, 0.219105327513939, -0.103319233651544, 0.219105327513939, 0.0936215603443104,
  -0.28097690824688, 0.0936215603443104, -0.28097690824688, -0.103319233651544, 0.219105327513939,
  -0.103319233651544, 0.219105327513939, 0.0936215603443104,-0.28097690824688, 0.0936215603443104,
  -0.28097690824688, -0.103319233651544, 0.219105327513939, -0.103319233651544, 0.219105327513939,
  0.0936215603443104, -0.28097690824688, 0.0936215603443104, -0.28097690824688, 0.0864346699862441,
  -0.206609522661332, -0.0946306505423971, 0.171145687194367, 0.0864346699862441, -0.206609522661332,
  -0.0946306505423971, 0.171145687194367, 0.0864346699862441, -0.206609522661332, -0.0946306505423971,
  0.171145687194367, 0.0864346699862441, -0.206609522661332, -0.0946306505423971, 0.171145687194367,
  0.34559993682419, 0.118920420042774, 0.34559993682419, 0.118920420042774, -0.532332361073909,
  -0.134990827478621, -0.532332361073909, -0.134990827478621, 0.34559993682419, 0.118920420042774,
  0.34559993682419, 0.118920420042774, -0.532332361073909, -0.134990827478621, -0.532332361073909,
  -0.134990827478621, 0.34559993682419, 0.118920420042774, 0.34559993682419, 0.118920420042774,
  -0.532332361073909, -0.134990827478621, -0.532332361073909, -0.134990827478621, -0.281680043762985,
  0.170331900494691, 0.219548958459497, -0.205425339530735, -0.281680043762985, 0.170331900494691,
  0.219548958459497, -0.205425339530735, -0.281680043762985, 0.170331900494691, 0.219548958459497,
  -0.205425339530735, -0.281680043762985, 0.170331900494691, 0.219548958459497, -0.205425339530735),
  .Dim = c(2L, 4L, 5L, 3L))


alpha_4latent_test <- structure(c(1.00020021445258, 0.000701057459227741, 1.00068521859567,
                             0.000527959984261543, 1.00091687577451, 0.000807935200864449,
                             1.00028439945728, 0.0009565001251176, 1.00010465012793, 0.000110453018685803),
                           .Dim = c(2L, 5L))


update_alpha_test_result_seed5 <- structure(c(1.00010465012793, 0.000110453018685803, 1.00070105745923,
                                              0.000273284949595109, 1.00052795998426, 0.000490513201802969,
                                              1.00080793520086, 0.000318404018646106, 1.00095650012512,
                                              0.000559172826586291),
                                            .Dim = c(2L, 5L))

updated_p_y_given_x_3d <- structure(c(0.0120966860928375, 0.37678808994633, 0.0153701508717977,
                                      0.376791949782257, 0.00843794530480509, 0.376931392538745,
                                      0.0107323476636507, 0.376935253639364, 0.987623693745951,
                                      0.303090551639091, 0.984277348430314, 0.303113975604685,
                                      0.991375794272762, 0.303009682882093, 0.989032603345896,
                                      0.303033100434402, 0.000279620161211356, 0.320121358414579,
                                      0.000352500697888493, 0.320094074613059, 0.000186260422432821,
                                      0.320058924579162, 0.000235048990453142, 0.320031645926234),
                                    .Dim = c(2L, 4L, 3L))

updated_log_z <- structure(c(0.816755123445272, -7.36603179469996e-06, 0.768964780157148,
                             -6.05274571589323e-06, 0.89275126619304, -3.75601370286249e-05,
                             0.843933262518173, -3.62463115813506e-05),
                           .Dim = c(2L, 4L))

updated_tc <- list(tcs = structure(c(0.830601108078408, -2.18063065301422e-05),
                                   .Dim = 2:1),
                   tc_history = list(
                       structure(c(0.830601108078408, -2.18063065301422e-05),
                                 .Dim = 2:1)))



### arguments for estimate parameters functions
data_est_tests = matrix(c(0,0,0,0,0,
                0,0,0,1,3,
                1,1,1,0,0,
                1,1,2,1,1), ncol=5, byrow = TRUE)

p_y_given_x_3d_estimate_discrete <- structure(c(0.352571404064629, 0.516565616454422, 0.271996744666052,
                                                0.259660130196914, 0.38299426688219, 0.516368047392833,
                                                0.457227950088999, 0.525449045419763, 0.266052920442782,
                                                0.224950707204062, 0.399166059983369, 0.489836543528228,
                                                0.295052625911883, 0.226610440633316, 0.30934529251417,
                                                0.241025360750108, 0.381375675492589, 0.258483676341517,
                                                0.328837195350579, 0.250503326274858, 0.321953107205926,
                                                0.25702151197385, 0.233426757396831, 0.233525593830129),
                                              .Dim = c(2L, 4L, 3L))

est_pars_discrete_nosmooth_result <- structure( c(-0.690196062363251, -1.16482769262915, -7.29219446054588,
                                                 -1.68273458973219, -0.566587691749003, -1.24155904281171,
                                                 -7.50771358987276, -1.94449621428089, -0.817926446411135,
                                                 -1.41193055914126, -7.14961608357323, -1.15773647265773,
                                                 -0.963775333588961, -1.58965570378756, -7.07869822094153,
                                                 -0.88258705381008, -0.589206179256023, -1.68930824336754,
                                                 -7.14645144727233, -1.34785226197017, -0.664197823465698,
                                                 -1.45371843305251, -6.91128315711602, -1.38382694191872),
                                                .Dim = c(4L, 2L, 3L))

est_pars_discrete_withsmooth_result <- structure(c(-0.691428442324175, -1.25150837227929, -7.83340460080994,
            -1.54801054848486, -0.616060958273512, -1.29782620898409, -8.02865783834929,
            -1.67942298347093, -0.762123655742672, -1.40077943290783, -7.71494591260892,
            -1.25010491763946, -0.84152734628134, -1.49948951722073, -7.620674905645,
            -1.06359064695744, -0.635395587717837, -1.53931139209157, -7.75752981404189,
            -1.36524616439491, -0.676415722007678, -1.42446686681132, -7.46567266459528,
            -1.38487627511918), .Dim = c(4L, 2L, 3L))


tc_hist_converged <- list(structure(c(0.0919859795589572, 0.00544256960649925), .Dim = 2:1),
     structure(c(0.536840469673255, 0.0212412648471452), .Dim = 2:1),
     structure(c(1.19480727651736, 0.0781317872088292), .Dim = 2:1),
     structure(c(1.36132996135349, 0.237936327502543), .Dim = 2:1),
     structure(c(1.38376905327964, 0.483661910947172), .Dim = 2:1),
     structure(c(1.38405118147144, 0.633487779837526), .Dim = 2:1),
     structure(c(1.38405123782951, 0.680365673117113), .Dim = 2:1),
     structure(c(1.38405127508472, 0.691033475969152), .Dim = 2:1),
     structure(c(1.38405131288432, 0.691644466118563), .Dim = 2:1),
     structure(c(1.38405135124099, 0.691648885312992), .Dim = 2:1),
     structure(c(1.38405139016679, 0.691648906408284), .Dim = 2:1),
     structure(c(1.38405142967412, 0.691648907783547), .Dim = 2:1),
     structure(c(1.38405146977576, 0.691648909075495), .Dim = 2:1),
     structure(c(1.38405151048485, 0.69164891037193), .Dim = 2:1),
     structure(c(1.38405155181492, 0.691648911673268), .Dim = 2:1),
     structure(c(1.38405159377991, 0.691648912979536), .Dim = 2:1),
     structure(c(1.38405163639416, 0.691648914290762), .Dim = 2:1),
     structure(c(1.38405167967248, 0.691648915606969), .Dim = 2:1),
     structure(c(1.38405172363009, 0.691648916928184), .Dim = 2:1))


#### test for bernoulii with 6x6 data ####
databern6 <- structure(c(1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1,
            1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1), .Dim = c(6L,
                                                                               6L))
py_givenx_bern6x6 <- structure(c(1.27632088022556e-06, 0.406193501375356, 0.23812353163779,
                             9.14124859079801e-07, 1.3922485856265e-06, 0.538576347240485,
                             0.149429661675358, 0.00112949805729352, 0.17323143285742,
                             4.01461333842228e-09, 0.000126024059091447, 0.17323143285742,
                             0.149774061832853, 0.40423908087935, 0.488329127370659,
                             0.149429661675358, 1.39217845413004e-06, 0.222953884916275,
                             0.0258763381453547, 0.00109518674344933, 0.0804079925247564,
                             0.00145441384814551, 9.14103949740165e-05, 0.327247896586789,
                             1.39796749313813e-08, 0.996617632140975, 0.0440862485740045,
                             0.997674218303536, 0.999672709184477, 0.0440862485740045,
                             1.09960423963161e-09, 9.15164827324877e-05, 0.401725556610005,
                             1.39796749313813e-08, 0.0010842126267496, 0.0556063903872003,
                             0.974122159244999, 5.7106357125422e-07, 0.136895191940324,
                             0.998544510392916, 0.999906265151506, 0.0797618996396183,
                             1.45602313261888e-07, 0.00114007056810779, 0.130918662099786,
                             0.00232577755600318, 9.32700196145544e-05, 0.130918662099786,
                             2.08870174735897e-07, 5.70196819323174e-07, 0.0667664779342368,
                             1.45602313261888e-07, 0.998913459315822, 0.138836385618678,
                             2.26288765702136e-07, 0.592710740817623, 0.54457328389713,
                             1.61634079665161e-07, 9.32204934446445e-07, 0.054413856533108,
                             0.850570178742654, 0.00111279923362417, 0.65176365646879,
                             1.2584716098644e-10, 0.000107996736817301, 0.65176365646879,
                             0.850225728197368, 0.595668832441098, 0.0431788380850993, 0.850570178742654,
                             9.35878974027318e-07, 0.582603339077847), .Dim = c(3L, 6L, 4L
                             ))

bern6result <- structure(c(-0.00222643435128376, -6.10846692943418, -0.694316546828901,
                           -0.691979180111471, -0.729418558613683, -0.658145496154548,
                           -6.9343730193069, -0.000974207775732681, -0.694680828435557,
                           -0.691615881158866, -0.642446382818512, -0.746556483689566,
                           -7.5888323059681, -0.000506199743397317, -0.693120211700754,
                           -0.693174150146476, -0.709390136288867, -0.677163847026783,
                           -0.000391868571200359, -7.84477997982935, -0.689827009984113,
                           -0.69647841140059, -0.682613176493323, -0.703793332280159), .Dim = 2:4)

#### test for discrete data with dim_visible=3 and 7x7data ####
datadisc3_7 <- structure(c(0, 1, 1, 2, 0, 0, 2, 0, 0, 1, 0, 1, 0, 1, 2, 0, 1,
                         2, 2, 2, 0, 1, 0, 2, 2, 0, 0, 1, 1, 2, 2, 0, 0, 1, 1, 2, 0, 0,
                         0, 1, 0, 1, 0, 1, 1, 0, 0, 2, 2), .Dim = c(7L, 7L))

py_givenxdisc3_7 <- structure(c(7.49492720371975e-08, 0.0236214564299067, 0.388938139425228,
                                0.934059260045658, 0.99999919163015, 1.2382517573588e-06,
                                0.385941896714751, 0.0114175823981009, 0.999999413449825,
                                1.17219611001807e-06, 0.00226193242264769, 0.0151104501449344,
                                3.73200456294907e-08, 0.00571476666447648, 0.385941896714751,
                                0.0151947843086829, 3.73200456294907e-08, 0.0252197728450712,
                                9.78608024768425e-07, 0.0115062761049953, 4.436807196857e-08,
                                0.0280168708604529, 0.385941896714751, 0.0114936920010173,
                                2.50287624723433e-07, 5.89217126230328e-05, 9.78608024768425e-07,
                                0.933982739638152, 0.415683250521652, 0.976365719820675,
                                8.13078557128903e-07, 0.016752452949853, 2.95769621565256e-07,
                                8.13594809084163e-09, 0.000137803463604409, 0.337542741418091,
                                2.86082169872207e-07, 8.12468060964537e-09, 0.507500825694321,
                                0.0179049434017941, 0.0142311439293098, 0.00403946335134204,
                                0.000137803463604409, 0.0179156408343948, 0.0142311439293098,
                                0.974416973316422, 0.615578575397337, 0.337605017331976,
                                0.00198006879227388, 0.971611194323445, 0.000137803463604409,
                                0.337667687076309, 0.000446273554264908, 1.36870176120366e-06,
                                0.615578575397337, 0.0167806000886607, 0.0417030932021833,
                                3.68209399994169e-10, 4.06878237458169e-06, 0.0166114111186042,
                                4.48803627136741e-08, 0.994146002977556, 0.000286787110488215,
                                0.270933062528083, 4.48766872026792e-08, 0.994343750474292,
                                0.210015095937796, 0.0219532609738033, 0.970617201420074,
                                4.5197947851872e-08, 0.000286787110488215, 0.0219651635819382,
                                0.970617201420074, 4.22233906246123e-10, 0.120213420863007,
                                0.270981609953021, 1.26249873666719e-05, 1.8791015195749e-08,
                                0.000286787110488215, 0.271027761069315, 1.8973295044902e-06,
                                1.00062413673515e-06, 0.120213420863007, 0.0166370880756792,
                                0.538647522463996, 9.99142637963883e-06, 1.88324996061882e-06,
                                0.0160294575492612, 2.176184319902e-07, 1.740456051845e-05,
                                0.000175168572480943, 0.150628612939519, 2.11124292256827e-07,
                                1.73889498262992e-08, 0.27796603770693, 0.91890336424088,
                                0.0151506275630101, 0.990213251589674, 0.000175168572480943,
                                0.918783423004338, 0.0151506275630101, 0.000359938079053894,
                                0.264206410570159, 0.150390600129228, 0.00203578761923315,
                                0.000359092863237794, 0.000175168572480943, 0.150259178720042,
                                0.000430294334361031, 0.99986973110267, 0.264206410570159,
                                0.0160283352218267, 0.00396605886289656, 2.83195482904913e-06,
                                0.611055095463879, 0.0165474183366232, 2.50101433205455e-07,
                                0.00583534607421986, 0.613458344138676, 0.229478000716206,
                                4.44670256753143e-08, 0.00565505181596795, 0.00225610823830546,
                                0.0261279812385885, 9.89767559891042e-07, 3.24731965597756e-05,
                                0.613458344138676, 0.0261409882706464, 9.89767559891042e-07,
                                3.31533721863078e-06, 6.14561472910095e-07, 0.22951649648078,
                                0.995971474233054, 1.28231618486253e-05, 0.613458344138676,
                                0.229551681133317, 0.999121284494245, 6.8977858809106e-05,
                                6.14561472910095e-07, 0.0165712369756809), .Dim = c(4L, 7L, 5L))

disc3_7result <- structure(c(-7.60224423591688, -0.000999223568127869, -7.60211329472097,
            -0.0951967830761956, -4.44767717652806, -2.53703897337873, -0.693318383981782,
            -1.38321437215224, -1.38904048774879, -0.703348164066185, -4.25305291424504,
            -0.711608930469425, -0.0378030835454003, -6.10771536540931, -3.35607574793575,
            -0.00206424990296797, -7.98254849995866, -6.36499360209628, -1.03842004421994,
            -1.23109280109649, -1.03842136261856, -0.448424790157669, -1.11330360835504,
            -3.41444570382417, -0.672853632117165, -7.59376397654727, -0.714889875625819,
            -7.59661921117878, -0.00100531290506419, -7.59559351685191, -1.31882232754906,
            -0.765483953035912, -1.31885581485181, -0.467449654367126, -1.11151599614865,
            -3.11582305727681, -0.0310855750819627, -6.35292398263684, -3.54509988233808,
            -7.05025625977511, -7.58054047648552, -0.00137842164174874, -1.11574268958215,
            -1.06520072804417, -1.11574978594236, -1.99001281938184, -0.775144023680271,
            -0.909640659275242, -0.693239113032709, -7.60163794965903, -0.694054928972085,
            -2.66296955040062, -0.156802128695389, -2.58513385727949, -0.695453491647786,
            -1.38216304591321, -1.38582702400081, -0.488644863825864, -1.10781338702719,
            -2.87772733441129), .Dim = 3:5)


#### data to test estimate_sig() function ####
sig_x_select <- structure(c(TRUE, FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, TRUE,
                            FALSE, FALSE, FALSE, TRUE, TRUE, FALSE, FALSE, TRUE, FALSE, FALSE,
                            FALSE, FALSE, TRUE), .Dim = c(3L, 7L))
sig_term <- structure(c(-0.154151155164854, -0.559616263273018, -0.559616263273018,
                        -3.34062951353204, -3.7460946216402, -3.7460946216402, -0.409670404207369,
                        -0.815135512315533, -0.815135512315533, -0.188346351661581, -0.593811459769746,
                        -0.593811459769746, -1.65345146201078, -2.05891657011895, -2.05891657011895,
                        0.226487007993929, -0.178978100114236, -0.178978100114236, -0.293946107786993,
                        -0.699411215895157, -0.699411215895157, -0.768330423131835, -1.17379553124,
                        -1.17379553124, -0.162711162368496, -0.568176270476661, -0.568176270476661,
                        -0.159921891853003, -0.565386999961167, -0.565386999961167, -1.64290672278073,
                        -2.0483718308889, -2.0483718308889, -0.963708810820184, -1.36917391892835,
                        -1.36917391892835, -1.40693689409172, -1.81240200219989, -1.81240200219989,
                        -0.158746510994044, -0.564211619102209, -0.564211619102209, -1.06184565155979,
                        -1.46731075966795, -1.46731075966795, -0.0052898357698648, -0.410754943878029,
                        -0.410754943878029, -0.154620244208472, -0.560085352316636, -0.560085352316636,
                        -5.30311576910838, -5.70858087721655, -5.70858087721655, 0.0502941205134475,
                        -0.355170987594717, -0.355170987594717, -1.10356679508076, -1.50903190318892,
                        -1.50903190318892), .Dim = 3:5)
# uses also py_givenxdisc3_7
estsig_result <- structure(c(2.06313458560436, 0.0387414471485073, 0.786194744270184,
                             1.85329595162512, 0.749108448903946, 1.92728262635708, 1.44965345852587,
                             0.395754608120157, 1.66613762759161, 2.05126171002348, 0.39015056638395,
                             0.29127761135769, 0.991208113406456, 2.12694424596655, 0.668203760443655,
                             0.951970790385207, 2.00396613868832, 0.0112630408652883, 1.2532081568531,
                             0.22583688547725), .Dim = 4:5) # with seed 555
